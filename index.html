<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" href="./coin.png"> 
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');

            body, a {
                font-family: 'Montserrat', sans-serif;
                text-align: center;
            }

            @media (prefers-color-scheme: light) {
                body, a {
                    background-color: #FFF;
                    color: #000;
                }
            }

            @media (prefers-color-scheme: dark) {
                body, a  {
                    background-color: #121212;
                    color: rgba(255,255,255,.8)
                }
            }

            #gr-yes {
                color: #66bb6a;
                text-align: center;
                display: none;
            }

            #gr-no {
                text-align: center;
                display: none;
            }

            .data {
                font-style: italic;
            }

            .footer {
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100%;
                padding-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div>
            <div id="gr-yes">
                <h1>Yes, it's <a href="https://seaofthieves.fandom.com/wiki/Gold_Rush" target="_blank">Gold Rushpyt</a>!</h1>
            </div>
            <div id="gr-no">
                <h1>No, it's not <a href="https://seaofthieves.fandom.com/wiki/Gold_Rush" target="_blank">Gold Rush</a>.</h1>
                <h2>The next gold rush starts at <span id="until"></span>.</h2>
            </div>
            <div class="footer">
                <p class="data">This page will automatically refresh every minute.</p>
                <a href="https://github.com/ImDevinC" target="_blank">Created by @ImDevinC</a>
                &nbsp;||&nbsp;
                <a href="https://twitch.tv/gnomebytes" target="_blank">Twitch @gnomebytes</a>
            </div>
        </div>
        <script>
            let grYes = document.getElementById('gr-yes')
            let grRemaining = document.getElementById('remaining')
            let grNo = document.getElementById('gr-no')
            let grUntil = document.getElementById('until')

            let goldRushHours = [1,17]
            let isGoldRush = (d) => {
                return goldRushHours.includes(d.getUTCHours())
            }

            let currentGoldRush = (d) => {
                document.title = 'IsItGoldRush - YES!'
                grYes.style.display = 'block'
                grNo.style.display = 'none'
            }

            let nextGoldRush = (d) => {
                let lastDate = new Date()
                let dates = []
                goldRushHours.every(h => {
                    let nextDate = new Date(d)
                    nextDate.setUTCMinutes(0)
                    nextDate.setUTCSeconds(0)
                    nextDate.setUTCHours(h)
                    if (nextDate < d) { 
                        nextDate.setUTCDate(nextDate.getUTCDate() + 1)
                    }
                    dates.push(nextDate)
                    return true
                })
                first = dates.reduce((pre, cur) => {
                    return pre > cur ? cur : pre
                })
                
                grUntil.innerText = new Intl.DateTimeFormat('en-US', {
                    hour: 'numeric',
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timeZoneName: 'short'
                }).format(first)
                document.title = 'IsItGoldRush - NO!'
                grYes.style.display = 'none'
                grNo.style.display = 'block'
            }

            let check = () => {
                currentDate = new Date()
                let gr = isGoldRush(currentDate)
                if (gr) {
                    currentGoldRush(currentDate)
                } else {
                    nextGoldRush(currentDate)
                }
                setTimeout(check, 60000)
            }

            check()
        </script>
    </body>
</html>
